# Python CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-python/ for more details
#
version: 2
jobs:
  build:
    docker:
      - image: circleci/python:2.7
    working_directory: ~/repo
    steps:
      - checkout

      # - restore_cache:
      #     keys:
      #     - v1-dependencies-{{ checksum "requirements.txt" }}
      #     # fallback to using the latest cache if no exact match is found
      #     - v1-dependencies-
      # - run:
      #     name: install dependencies
      #     command: |
      #       python3 -m venv venv
      #       . venv/bin/activate
      #       pip install -r requirements.txt
      # - save_cache:
      #     paths:
      #       - ./venv
      #     key: v1-dependencies-{{ checksum "requirements.txt" }}
      # - run:
      #     name: run tests
      #     command: |
      #       . venv/bin/activate
      #       python manage.py test
      # - store_artifacts:
      #     path: test-reports
      #     destination: test-reports

      - run:
          name: Install PlatformIO
          command: sudo pip install platformio
      - run:
          name: Run build for custom board
          command: platformio ci examples/Custom/Custom.cpp --lib="." --project-conf="examples/Custom/Custom.ini"
      - run:
          name: Run build for Sonoff Basic board
          command: platformio ci examples/SonoffBasic/SonoffBasic.cpp --lib="." --project-conf="examples/SonoffBasic/SonoffBasic.ini"
      - run:
          name: Run build for Sonoff S20 board
          command: platformio ci examples/SonoffS20/SonoffS20.cpp --lib="." --project-conf="examples/SonoffS20/SonoffS20.ini"
